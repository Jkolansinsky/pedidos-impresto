<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Copiado - Hacer Pedido</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="top-header">
        <div class="logo">
            <i class="fa-solid fa-cart-arrow-down">Impresto!</i> 
        </div>
        <div style="display: flex; gap: 15px;">
            <a href="usuario.html" style="color: white; text-decoration: none;">
                <button class="btn btn-info">
                    <i class="fas fa-user-tie"></i> Usuario
                </button>
            </a>
            <a href="admin.html" style="color: white; text-decoration: none;">
                <button class="btn btn-danger">
                    <i class="fas fa-user-shield"></i> Admin
                </button>
            </a>
            <a href="repartidor.html" style="color: white; text-decoration: none;">
                <button class="btn btn-warning">
                    <i class="fas fa-motorcycle"></i> Repartidor
                </button>
            </a>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-print"></i> Centro de Copiado</h1>
            <p>Sistema de Pedidos Pick-up y Entrega a Domicilio</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('pedido')">
                <i class="fas fa-shopping-cart"></i> Hacer Pedido
            </button>
            <button class="nav-tab" onclick="showTab('tracking')">
                <i class="fas fa-map-marked-alt"></i> Rastrear Pedido
            </button>
        </div>

        <div class="content">
            <!-- TAB PEDIDO -->
            <div id="pedido-tab" class="tab-content active">
                <div id="client-info-step">
                    <h2><i class="fas fa-user-circle"></i> Información del Cliente</h2>
                    <div class="form-group">
                        <label>Nombre Completo *</label>
                        <input type="text" id="clientName" placeholder="Ej: Juan Pérez" required>
                    </div>
                    <div class="form-group">
                        <label>Teléfono / WhatsApp *</label>
                        <input type="tel" id="clientPhone" placeholder="Ej: 9931234567" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="clientEmail" placeholder="cliente@ejemplo.com">
                    </div>
                    <button class="btn btn-primary" onclick="saveClientInfo()">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div id="service-type-step" class="hidden">
                    <h2><i class="fas fa-tasks"></i> Selecciona el Tipo de Servicio</h2>
                    <div class="service-type">
                        <div class="service-card" onclick="selectService('pickup')">
                            <i class="fas fa-store"></i>
                            <h3>Pick-up en Sucursal</h3>
                            <p>Recoge tu pedido en la sucursal de tu elección</p>
                        </div>
                        <div class="service-card" onclick="selectService('delivery')">
                            <i class="fas fa-shipping-fast"></i>
                            <h3>Entrega a Domicilio</h3>
                            <p>Recibe tu pedido en tu dirección</p>
                        </div>
                    </div>
                </div>

                <div id="branch-selection-step" class="hidden">
                    <h2><i class="fas fa-map-marker-alt"></i> Selecciona la Sucursal</h2>
                    <div class="form-group">
                        <label>Sucursal *</label>
                        <select id="branchSelect">
                            <option value="">Selecciona una sucursal</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="confirmBranch()">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="backToServiceType()">
                        <i class="fas fa-arrow-left"></i> Regresar
                    </button>
                </div>

                <div id="delivery-address-step" class="hidden">
                    <h2><i class="fas fa-home"></i> Dirección de Entrega</h2>
                    <div class="form-group">
                        <label>Calle y Número *</label>
                        <input type="text" id="deliveryStreet" placeholder="Ej: Av. Universidad #123">
                    </div>
                    <div class="form-group">
                        <label>Colonia *</label>
                        <input type="text" id="deliveryColony" placeholder="Ej: Centro">
                    </div>
                    <div class="form-group">
                        <label>Ciudad *</label>
                        <input type="text" id="deliveryCity" value="Villahermosa">
                    </div>
                    <div class="form-group">
                        <label>Código Postal</label>
                        <input type="text" id="deliveryZip" placeholder="86000">
                    </div>
                    <div class="form-group">
                        <label>Referencias</label>
                        <textarea id="deliveryReferences" rows="3" placeholder="Ej: Casa blanca con portón negro"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="confirmAddress()">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="backToServiceType()">
                        <i class="fas fa-arrow-left"></i> Regresar
                    </button>
                </div>

                <div id="work-config-step" class="hidden">
                    <h2><i class="fas fa-file-alt"></i> Configuración del Trabajo</h2>
                    
                    <div class="form-group">
                        <label>Tipo de Impresión *</label>
                        <select id="printType" onchange="updatePrintOptions()">
                            <option value="">Selecciona...</option>
                            <option value="CARTA">Carta</option>
                            <option value="OFICIO">Oficio</option>
                            <option value="DOBLE_CARTA">Doble Carta</option>
                            <option value="TABLOIDE">Tabloide</option>
                            <option value="PLOTEO">Ploteo</option>
                            <option value="LONAS">Lonas</option>
                            <option value="VINIL">Vinil</option>
                        </select>
                    </div>

                    <div id="vinilOptions" class="hidden">
                        <div class="form-group">
                            <label>Tipo de Vinil *</label>
                            <select id="vinilType" onchange="calculateWorkPrice()">
                                <option value="TRANSPARENTE">Transparente</option>
                                <option value="NORMAL">Normal</option>
                                <option value="MICROPERFORADO">Microperforado</option>
                                <option value="TROVISEL_3MM">Trovisel 3mm</option>
                                <option value="TROVISEL_6MM">Trovisel 6mm</option>
                                <option value="IMANTADO">Imantado</option>
                            </select>
                        </div>
                    </div>

                    <div id="standardOptions" class="hidden">
                        <div class="form-group">
                            <label>Color *</label>
                            <select id="colorOption" onchange="calculateWorkPrice()">
                                <option value="BN">Blanco y Negro</option>
                                <option value="COLOR">Color</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Tipo de Papel *</label>
                            <select id="paperType" onchange="calculateWorkPrice()">
                                <option value="BOND">Bond</option>
                                <option value="KROMECOTE">Kromecote</option>
                                <option value="OPALINA">Opalina</option>
                                <option value="COUCHE_DELGADO">Couche Delgado</option>
                                <option value="COUCHE_GRUESO">Couche Grueso</option>
                            </select>
                        </div>
                    </div>

                    <div id="urgencyOptions" class="hidden">
                        <div class="form-group">
                            <label>Modalidad *</label>
                            <select id="urgencyMode" onchange="calculateWorkPrice()">
                                <option value="NORMAL">Entrega 24 hrs</option>
                                <option value="URGENTE">Urgente</option>
                            </select>
                        </div>
                    </div>

                    <div id="finishingOptions" class="hidden">
                        <div class="form-group">
                            <label>Acabado</label>
                            <select id="finishing" multiple size="6" onchange="calculateWorkPrice()">
                                <option value="ENGARGOLADO">Engargolado</option>
                                <option value="ENMICADO">Enmicado</option>
                                <option value="ENGRAPADO">Engrapado</option>
                                <option value="DOBLADO">Doblado</option>
                                <option value="OJILLOS">Con Ojillos (4)</option>
                                <option value="VULCANIZADO">Vulcanizado</option>
                            </select>
                            <small>Mantén Ctrl (Cmd en Mac) para seleccionar múltiples</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Cantidad de Copias/Juegos *</label>
                        <input type="number" id="copies" min="1" value="1" onchange="calculateWorkPrice()">
                    </div>

                    <div class="form-group">
                        <label>Observaciones / Detalles Especiales</label>
                        <textarea id="workObservations" rows="3" placeholder="Indica cualquier detalle especial..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Archivo *</label>
                        <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p id="fileName">Haz clic para subir tu archivo</p>
                            <small>PDF, Word, Excel, PowerPoint (Máx. 50MB)</small>
                        </div>
                        <input type="file" id="fileInput" class="hidden" onchange="handleFileSelect()" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx">
                        <button id="removeFileBtn" class="btn btn-danger hidden" onclick="removeFile()" style="margin-top: 10px;">
                            <i class="fas fa-trash"></i> Eliminar Archivo
                        </button>
                    </div>

                    <div id="workPrice" class="hidden" style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h4>Precio de este trabajo: <span id="currentWorkPrice" style="color: #667eea; font-size: 1.3em;">$0.00</span></h4>
                    </div>

                    <button class="btn btn-success" onclick="addToCart()">
                        <i class="fas fa-shopping-cart"></i> Agregar al Carrito
                    </button>
                    <button class="btn btn-warning" onclick="addAnotherWork()">
                        <i class="fas fa-plus"></i> Agregar Otro Trabajo
                    </button>
                </div>

                <div id="cart-step" class="hidden">
                    <h2><i class="fas fa-shopping-cart"></i> Carrito de Trabajos</h2>
                    <div id="cartItems"></div>
                    <div class="cart-total">
                        <p>Subtotal: $<span id="subtotal">0.00</span></p>
                        <p id="deliveryCostLine" class="hidden">Costo de Entrega: $<span id="deliveryCost">0.00</span></p>
                        <h3>Total: $<span id="total">0.00</span></h3>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>Método de Pago</label>
                        <select id="paymentMethod" onchange="updatePaymentInfo()">
                            <option value="TRANSFERENCIA">Transferencia Bancaria</option>
                            <option value="EFECTIVO">Efectivo (Solo en tienda)</option>
                        </select>
                    </div>

                    <div id="transferInfo" class="alert alert-warning">
                        <h4><i class="fas fa-university"></i> Datos para Transferencia</h4>
                        <p id="bankDetails">Cargando datos bancarios...</p>
                    </div>

                    <div id="uploadProof" class="form-group">
                        <label>Comprobante de Pago *</label>
                        <input type="file" id="proofInput" accept="image/*,.pdf" onchange="handleProofUpload()">
                        <small>Sube tu comprobante de transferencia</small>
                    </div>

                    <button id="submitOrderBtn" class="btn btn-primary" onclick="submitOrder()" disabled>
                        <i class="fas fa-paper-plane"></i> Enviar Pedido
                    </button>
                    <button class="btn btn-warning" onclick="backToWork()">
                        <i class="fas fa-plus"></i> Agregar Más Trabajos
                    </button>
                </div>
            </div>

            <!-- TAB TRACKING -->
            <div id="tracking-tab" class="tab-content">
                <h2><i class="fas fa-search-location"></i> Rastrear Pedido</h2>
                <div class="form-group">
                    <label>Número de Folio</label>
                    <input type="text" id="trackingFolio" placeholder="Ej: ORD-20250116-ABC123">
                </div>
                <button class="btn btn-primary" onclick="trackOrder()">
                    <i class="fas fa-search"></i> Buscar Pedido
                </button>
                <div id="trackingResults" style="margin-top: 30px;"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Ticket -->
    <div id="ticketModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-receipt"></i> Ticket de Pedido</h3>
                <button class="close-modal" onclick="closeTicketModal()">×</button>
            </div>
            <div id="ticketContent"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="printTicket()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button class="btn btn-success" onclick="downloadTicket()">
                    <i class="fas fa-download"></i> Descargar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p><strong>Procesando...</strong></p>
            <p style="font-size: 0.9em; color: #666;">Por favor espera un momento</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="js/config.js"></script>
    <script src="js/cliente.js"></script>
</body>
</html>


