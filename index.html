<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Copiado - Sistema de Pedidos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .top-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .top-header .logo {
            font-size: 1.2em;
            font-weight: bold;
        }

        .access-buttons {
            display: flex;
            gap: 15px;
        }

        .access-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .access-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 1.1em;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .service-type {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .service-card {
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .service-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .service-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .service-card i {
            font-size: 3em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .service-card h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .cart-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .cart-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .cart-item-details {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .cart-total {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: right;
        }

        .cart-total h3 {
            font-size: 1.5em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .hidden {
            display: none !important;
        }

        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            background: #f0f4ff;
        }

        .file-upload i {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .work-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .ticket {
            background: white;
            padding: 30px;
            border: 2px solid #333;
            font-family: 'Courier New', monospace;
        }

        .ticket-header {
            text-align: center;
            border-bottom: 2px dashed #333;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .ticket-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #999;
        }

        .order-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .status-new {
            background: #17a2b8;
            color: white;
        }

        .status-assigned {
            background: #6f42c1;
            color: white;
        }

        .status-processing {
            background: #ffc107;
            color: #333;
        }

        .status-ready {
            background: #28a745;
            color: white;
        }

        .status-delivering {
            background: #fd7e14;
            color: white;
        }

        .status-delivered {
            background: #6c757d;
            color: white;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 20px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 25px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -29px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e0e0e0;
        }

        .timeline-item.completed::before {
            background: #28a745;
            border-color: #28a745;
        }

        .timeline-item.active::before {
            background: #ffc107;
            border-color: #ffc107;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .timeline-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #e0e0e0;
        }

        .timeline-item.completed .timeline-content {
            border-left-color: #28a745;
        }

        .timeline-item.active .timeline-content {
            border-left-color: #ffc107;
        }

        .timeline-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .timeline-meta {
            font-size: 0.85em;
            color: #666;
        }

        .timeline-employee {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .admin-tab-content {
            display: none;
        }

        @media (max-width: 768px) {
            .service-type {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                font-size: 0.9em;
                padding: 12px 5px;
            }

            .access-buttons {
                gap: 10px;
            }

            .access-btn {
                padding: 6px 15px;
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="top-header">
        <div class="logo">
            <i class="fas fa-print"></i> Centro de Copiado
        </div>
        <div class="access-buttons">
            <button class="access-btn" onclick="showLoginModal('usuario')">
                <i class="fas fa-user-tie"></i> Usuario
            </button>
            <button class="access-btn" onclick="showLoginModal('admin')">
                <i class="fas fa-user-shield"></i> Admin
            </button>
        </div>
    </div>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-print"></i> Centro de Copiado</h1>
            <p>Sistema de Pedidos Pick-up y Entrega a Domicilio</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showMainTab('cliente')">
                <i class="fas fa-shopping-cart"></i> Hacer Pedido
            </button>
            <button class="nav-tab" onclick="showMainTab('tracking')">
                <i class="fas fa-map-marked-alt"></i> Rastrear Pedido
            </button>
        </div>

        <div class="content">
            <div id="cliente-tab" class="tab-content active">
                <div id="client-info-step">
                    <h2><i class="fas fa-user-circle"></i> Información del Cliente</h2>
                    <div class="form-group">
                        <label>Nombre Completo *</label>
                        <input type="text" id="clientName" placeholder="Ej: Juan Pérez" required>
                    </div>
                    <div class="form-group">
                        <label>Teléfono / WhatsApp *</label>
                        <input type="tel" id="clientPhone" placeholder="Ej: 9931234567" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="clientEmail" placeholder="cliente@ejemplo.com">
                    </div>
                    <button class="btn btn-primary" onclick="saveClientInfo()">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div id="service-type-step" class="hidden">
                    <h2><i class="fas fa-tasks"></i> Selecciona el Tipo de Servicio</h2>
                    <div class="service-type">
                        <div class="service-card" onclick="selectService('pickup')">
                            <i class="fas fa-store"></i>
                            <h3>Pick-up en Sucursal</h3>
                            <p>Recoge tu pedido en la sucursal de tu elección</p>
                        </div>
                        <div class="service-card" onclick="selectService('delivery')">
                            <i class="fas fa-shipping-fast"></i>
                            <h3>Entrega a Domicilio</h3>
                            <p>Recibe tu pedido en tu dirección</p>
                        </div>
                    </div>
                </div>

                <div id="branch-selection-step" class="hidden">
                    <h2><i class="fas fa-map-marker-alt"></i> Selecciona la Sucursal</h2>
                    <div class="form-group">
                        <label>Sucursal *</label>
                        <select id="branchSelect">
                            <option value="">Selecciona una sucursal</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="confirmBranch()">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="backToServiceType()">
                        <i class="fas fa-arrow-left"></i> Regresar
                    </button>
                </div>

                <div id="delivery-address-step" class="hidden">
                    <h2><i class="fas fa-home"></i> Dirección de Entrega</h2>
                    <div class="form-group">
                        <label>Calle y Número *</label>
                        <input type="text" id="deliveryStreet" placeholder="Ej: Av. Universidad #123">
                    </div>
                    <div class="form-group">
                        <label>Colonia *</label>
                        <input type="text" id="deliveryColony" placeholder="Ej: Centro">
                    </div>
                    <div class="form-group">
                        <label>Ciudad *</label>
                        <input type="text" id="deliveryCity" value="Villahermosa">
                    </div>
                    <div class="form-group">
                        <label>Código Postal</label>
                        <input type="text" id="deliveryZip" placeholder="86000">
                    </div>
                    <div class="form-group">
                        <label>Referencias</label>
                        <textarea id="deliveryReferences" rows="3" placeholder="Ej: Casa blanca con portón negro"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="confirmAddress()">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="backToServiceType()">
                        <i class="fas fa-arrow-left"></i> Regresar
                    </button>
                </div>

                <div id="work-config-step" class="hidden">
                    <h2><i class="fas fa-file-alt"></i> Configuración del Trabajo</h2>
                    
                    <div class="form-group">
                        <label>Tipo de Impresión *</label>
                        <select id="printType" onchange="updatePrintOptions()">
                            <option value="">Selecciona...</option>
                            <option value="CARTA">Carta</option>
                            <option value="OFICIO">Oficio</option>
                            <option value="DOBLE_CARTA">Doble Carta</option>
                            <option value="TABLOIDE">Tabloide</option>
                            <option value="PLOTEO">Ploteo</option>
                            <option value="LONAS">Lonas</option>
                            <option value="VINIL">Vinil</option>
                        </select>
                    </div>

                    <div id="vinilOptions" class="hidden">
                        <div class="form-group">
                            <label>Tipo de Vinil *</label>
                            <select id="vinilType" onchange="calculateWorkPrice()">
                                <option value="TRANSPARENTE">Transparente</option>
                                <option value="NORMAL">Normal</option>
                                <option value="MICROPERFORADO">Microperforado</option>
                                <option value="TROVISEL_3MM">Trovisel 3mm</option>
                                <option value="TROVISEL_6MM">Trovisel 6mm</option>
                                <option value="IMANTADO">Imantado</option>
                            </select>
                        </div>
                    </div>

                    <div id="standardOptions" class="hidden">
                        <div class="form-group">
                            <label>Color *</label>
                            <select id="colorOption" onchange="calculateWorkPrice()">
                                <option value="BN">Blanco y Negro</option>
                                <option value="COLOR">Color</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Tipo de Papel *</label>
                            <select id="paperType" onchange="calculateWorkPrice()">
                                <option value="BOND">Bond</option>
                                <option value="KROMECOTE">Kromecote</option>
                                <option value="OPALINA">Opalina</option>
                                <option value="COUCHE_DELGADO">Couche Delgado</option>
                                <option value="COUCHE_GRUESO">Couche Grueso</option>
                            </select>
                        </div>
                    </div>

                    <div id="urgencyOptions" class="hidden">
                        <div class="form-group">
                            <label>Modalidad *</label>
                            <select id="urgencyMode" onchange="calculateWorkPrice()">
                                <option value="NORMAL">Entrega 24 hrs</option>
                                <option value="URGENTE">Urgente</option>
                            </select>
                        </div>
                    </div>

                    <div id="finishingOptions" class="hidden">
                        <div class="form-group">
                            <label>Acabado</label>
                            <select id="finishing" multiple size="6" onchange="calculateWorkPrice()">
                                <option value="ENGARGOLADO">Engargolado</option>
                                <option value="ENMICADO">Enmicado</option>
                                <option value="ENGRAPADO">Engrapado</option>
                                <option value="DOBLADO">Doblado</option>
                                <option value="OJILLOS">Con Ojillos (4)</option>
                                <option value="VULCANIZADO">Vulcanizado</option>
                            </select>
                            <small>Mantén Ctrl (Cmd en Mac) para seleccionar múltiples</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Cantidad de Copias/Juegos *</label>
                        <input type="number" id="copies" min="1" value="1" onchange="calculateWorkPrice()">
                    </div>

                    <div class="form-group">
                        <label>Observaciones / Detalles Especiales</label>
                        <textarea id="workObservations" rows="3" placeholder="Indica cualquier detalle especial..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Archivo *</label>
                        <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p id="fileName">Haz clic para subir tu archivo</p>
                            <small>PDF, Word, Excel, PowerPoint (Máx. 50MB)</small>
                        </div>
                        <input type="file" id="fileInput" class="hidden" onchange="handleFileSelect()" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx">
                        <button id="removeFileBtn" class="btn btn-danger hidden" onclick="removeFile()" style="margin-top: 10px;">
                            <i class="fas fa-trash"></i> Eliminar Archivo
                        </button>
                    </div>

                    <div id="workPrice" class="hidden" style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h4>Precio de este trabajo: <span id="currentWorkPrice" style="color: #667eea; font-size: 1.3em;">$0.00</span></h4>
                    </div>

                    <button class="btn btn-success" onclick="addToCart()">
                        <i class="fas fa-shopping-cart"></i> Agregar al Carrito
                    </button>
                    <button class="btn btn-warning" onclick="addAnotherWork()">
                        <i class="fas fa-plus"></i> Agregar Otro Trabajo
                    </button>
                </div>

                <div id="cart-step" class="hidden">
                    <h2><i class="fas fa-shopping-cart"></i> Carrito de Trabajos</h2>
                    <div id="cartItems"></div>
                    <div class="cart-total">
                        <p>Subtotal: $<span id="subtotal">0.00</span></p>
                        <p id="deliveryCostLine" class="hidden">Costo de Entrega: $<span id="deliveryCost">0.00</span></p>
                        <h3>Total: $<span id="total">0.00</span></h3>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>Método de Pago</label>
                        <select id="paymentMethod" onchange="updatePaymentInfo()">
                            <option value="TRANSFERENCIA">Transferencia Bancaria</option>
                            <option value="EFECTIVO">Efectivo (Solo en tienda)</option>
                        </select>
                    </div>

                    <div id="transferInfo" class="alert alert-warning">
                        <h4><i class="fas fa-university"></i> Datos para Transferencia</h4>
                        <p id="bankDetails">Cargando datos bancarios...</p>
                    </div>

                    <div id="uploadProof" class="form-group">
                        <label>Comprobante de Pago *</label>
                        <input type="file" id="proofInput" accept="image/*,.pdf" onchange="handleProofUpload()">
                        <small>Sube tu comprobante de transferencia</small>
                    </div>

                    <button id="submitOrderBtn" class="btn btn-primary" onclick="submitOrder()" disabled>
                        <i class="fas fa-paper-plane"></i> Enviar Pedido
                    </button>
                    <button class="btn btn-warning" onclick="backToWork()">
                        <i class="fas fa-plus"></i> Agregar Más Trabajos
                    </button>
                </div>
            </div>

            <div id="tracking-tab" class="tab-content">
                <h2><i class="fas fa-search-location"></i> Rastrear Pedido</h2>
                <div class="form-group">
                    <label>Número de Folio</label>
                    <input type="text" id="trackingFolio" placeholder="Ej: ORD-20250114-001">
                </div>
                <button class="btn btn-primary" onclick="trackOrder()">
                    <i class="fas fa-search"></i> Buscar Pedido
                </button>
                <div id="trackingResults" style="margin-top: 30px;"></div>
                <div id="trackingMap" class="hidden" style="margin-top: 20px;">
                    <h3>Mapa de Seguimiento</h3>
                    <div id="map" style="height: 400px; border-radius: 8px; overflow: hidden;"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de Login -->
    <div id="loginModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-lock"></i> <span id="loginModalTitle">Iniciar Sesión</span></h3>
                <button class="close-modal" onclick="closeLoginModal()">×</button>
            </div>
            <div id="loginModalAlert" class="alert alert-error hidden"></div>
            <div class="form-group">
                <label>Usuario</label>
                <input type="text" id="modalUsername" placeholder="Ingresa tu usuario">
            </div>
            <div class="form-group">
                <label>Contraseña</label>
                <input type="password" id="modalPassword" placeholder="Ingresa tu contraseña">
            </div>
            <button class="btn btn-primary" onclick="processLogin()" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
            </button>
        </div>
    </div>

    <!-- Panel de Usuario -->
    <div id="usuarioPanel" class="modal">
        <div class="modal-content" style="max-width: 95%; max-height: 95vh;">
            <div class="modal-header">
                <h3><i class="fas fa-tachometer-alt"></i> Panel de Usuario - <span id="currentUserName"></span></h3>
                <div>
                    <button class="btn btn-danger" onclick="closeUsuarioPanel()">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="filterOrders('all')">Todos</button>
                <button class="btn btn-warning" onclick="filterOrders('new')">Nuevos</button>
                <button class="btn" style="background: #6f42c1; color: white;" onclick="filterOrders('assigned')">Asignados</button>
                <button class="btn" style="background: #ffc107; color: #333;" onclick="filterOrders('processing')">En Proceso</button>
                <button class="btn btn-success" onclick="filterOrders('ready')">Listos</button>
            </div>
            
            <div id="usuarioOrdersList"></div>
        </div>
    </div>

    <!-- Panel de Admin -->
    <div id="adminPanel" class="modal">
        <div class="modal-content" style="max-width: 95%; max-height: 95vh;">
            <div class="modal-header">
                <h3><i class="fas fa-tools"></i> Panel de Administración</h3>
                <button class="btn btn-danger" onclick="closeAdminPanel()">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>

            <div class="nav-tabs" style="margin-bottom: 20px;">
                <button class="nav-tab active" onclick="showAdminTab('orders')">
                    <i class="fas fa-list"></i> Pedidos
                </button>
                <button class="nav-tab" onclick="showAdminTab('prices')">
                    <i class="fas fa-dollar-sign"></i> Precios
                </button>
                <button class="nav-tab" onclick="showAdminTab('branches')">
                    <i class="fas fa-store"></i> Sucursales
                </button>
                <button class="nav-tab" onclick="showAdminTab('reports')">
                    <i class="fas fa-chart-bar"></i> Reportes
                </button>
            </div>

            <!-- Tab Pedidos Admin -->
            <div id="admin-orders-tab" class="admin-tab-content">
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="filterAdminOrders('all')">Todos</button>
                    <button class="btn" style="background: #17a2b8; color: white;" onclick="filterAdminOrders('new')">Nuevos</button>
                    <button class="btn" style="background: #6f42c1; color: white;" onclick="filterAdminOrders('assigned')">Asignados</button>
                    <button class="btn btn-warning" onclick="filterAdminOrders('processing')">En Proceso</button>
                    <button class="btn btn-success" onclick="filterAdminOrders('ready')">Listos</button>
                    <button class="btn" style="background: #fd7e14; color: white;" onclick="filterAdminOrders('delivering')">En Camino</button>
                    <button class="btn btn-secondary" onclick="filterAdminOrders('delivered')">Entregados</button>
                </div>
                <div id="adminOrdersList"></div>
            </div>

            <!-- Tab Precios -->
            <div id="admin-prices-tab" class="admin-tab-content hidden">
                <h4><i class="fas fa-list-ul"></i> Precios Actuales</h4>
                <div id="pricesTable" style="overflow-x: auto; margin-bottom: 30px;"></div>
                <hr style="margin: 30px 0;">
                <h4><i class="fas fa-edit"></i> Agregar/Editar Precio</h4>
                <div class="form-group">
                    <label>Categoría *</label>
                    <input type="text" id="priceCategory" placeholder="Ej: CARTA, VINIL, ACABADO">
                    <small>Ejemplos: CARTA, OFICIO, VINIL, LONAS, ACABADO, DELIVERY_FEE</small>
                </div>
                <div class="form-group">
                    <label>Subcategoría</label>
                    <input type="text" id="priceSubcategory" placeholder="Ej: BN_BOND, COLOR_BOND">
                    <small>Para CARTA: BN_BOND, COLOR_BOND, COLOR_KROMECOTE, etc. Para ACABADO: ENGARGOLADO, ENMICADO, etc.</small>
                </div>
                <div class="form-group">
                    <label>Precio *</label>
                    <input type="number" id="priceValue" step="0.01" placeholder="0.00">
                </div>
                <button class="btn btn-success" onclick="savePrice()">
                    <i class="fas fa-save"></i> Guardar Precio
                </button>
            </div>

            <!-- Tab Sucursales -->
            <div id="admin-branches-tab" class="admin-tab-content hidden">
                <h4><i class="fas fa-list-ul"></i> Sucursales Actuales</h4>
                <div id="branchesTable" style="overflow-x: auto; margin-bottom: 30px;"></div>
                <hr style="margin: 30px 0;">
                <h4><i class="fas fa-plus-circle"></i> Agregar Nueva Sucursal</h4>
                <div class="form-group">
                    <label>Nombre de Sucursal *</label>
                    <input type="text" id="branchName" placeholder="Ej: Tamulte">
                </div>
                <div class="form-group">
                    <label>Dirección *</label>
                    <input type="text" id="branchAddress" placeholder="Dirección completa">
                </div>
                <div class="form-group">
                    <label>Teléfono *</label>
                    <input type="text" id="branchPhone" placeholder="9931234567">
                </div>
                <div class="form-group">
                    <label>Datos Bancarios *</label>
                    <textarea id="branchBankData" rows="4" placeholder="Banco: BBVA&#10;Cuenta: 0123456789&#10;CLABE: 012345678901234567&#10;Titular: Centro de Copiado SA"></textarea>
                </div>
                <button class="btn btn-success" onclick="saveBranch()">
                    <i class="fas fa-save"></i> Guardar Sucursal
                </button>
            </div>

            <!-- Tab Reportes -->
            <div id="admin-reports-tab" class="admin-tab-content hidden">
                <h4><i class="fas fa-chart-line"></i> Generar Reportes</h4>
                <div class="form-group">
                    <label>Tipo de Reporte</label>
                    <select id="reportType">
                        <option value="daily">Por Día</option>
                        <option value="client">Por Cliente</option>
                        <option value="service">Por Tipo de Servicio</option>
                        <option value="employee">Por Empleado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Fecha Inicio</label>
                    <input type="date" id="reportStartDate">
                </div>
                <div class="form-group">
                    <label>Fecha Fin</label>
                    <input type="date" id="reportEndDate">
                </div>
                <button class="btn btn-primary" onclick="generateReport()">
                    <i class="fas fa-file-export"></i> Generar Reporte
                </button>
                <div id="reportResults" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Ticket -->
    <div id="ticketModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-receipt"></i> Ticket de Pedido</h3>
                <button class="close-modal" onclick="closeTicketModal()">×</button>
            </div>
            <div id="ticketContent"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="printTicket()">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button class="btn btn-success" onclick="downloadTicket()">
                    <i class="fas fa-download"></i> Descargar
                </button>
                <button class="btn btn-warning" onclick="sendToWhatsApp()">
                    <i class="fab fa-whatsapp"></i> Enviar por WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Detalle de Pedido -->
    <div id="orderDetailModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-file-invoice"></i> Detalle del Pedido</h3>
                <button class="close-modal" onclick="closeOrderDetail()">×</button>
            </div>
            <div id="orderDetailContent"></div>
            
            <!-- Timeline del Pedido -->
            <div style="margin-top: 30px;">
                <h4><i class="fas fa-history"></i> Historial del Pedido</h4>
                <div id="orderTimeline" class="timeline"></div>
            </div>

            <div style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <h4><i class="fas fa-sync-alt"></i> Actualizar Estado</h4>
                <div class="form-group">
                    <label>Nuevo Estado</label>
                    <select id="orderStatus">
                        <option value="new">Nuevo (Recibido)</option>
                        <option value="assigned">Asignado a Empleado</option>
                        <option value="processing">En Elaboración</option>
                        <option value="ready">Listo para Entrega</option>
                        <option value="delivering">En Camino</option>
                        <option value="delivered">Entregado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notas adicionales</label>
                    <textarea id="statusNotes" rows="2" placeholder="Agregar nota..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="updateOrderStatus()">
                        <i class="fas fa-save"></i> Actualizar Estado
                    </button>
                    <button class="btn btn-primary" onclick="notifyClient()">
                        <i class="fas fa-bell"></i> Notificar Cliente
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p><strong>Procesando...</strong></p>
            <p style="font-size: 0.9em; color: #666;">Por favor espera un momento</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script>
        // URL de tu Google Apps Script (CAMBIAR POR LA TUYA)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwrJgWCzCuEgdRH7kE0NNJ9sxJRi5k7LOc7L51TnzghZB95vTsjmUn1sbFFNT-pKYjUfA/exec';

        // Variables globales
        let currentClient = {};
        let currentService = '';
        let currentBranch = '';
        let cart = [];
        let currentFile = null;
        let currentProof = null;
        let currentUser = null;
        let currentLoginType = null;
        let prices = {};
        let branches = [];
        let currentOrder = null;
        let allOrders = [];

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            loadBranches();
            loadPrices();
        });
        // FUNCIONES DE NAVEGACIÓN
        function showMainTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-tabs .nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        function showLoginModal(type) {
            currentLoginType = type;
            document.getElementById('loginModalTitle').textContent = type === 'admin' ? 'Admin - Iniciar Sesión' : 'Usuario - Iniciar Sesión';
            document.getElementById('loginModal').classList.add('active');
            document.getElementById('modalUsername').value = '';
            document.getElementById('modalPassword').value = '';
            document.getElementById('loginModalAlert').classList.add('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
            currentLoginType = null;
        }

        async function processLogin() {
            const username = document.getElementById('modalUsername').value.trim();
            const password = document.getElementById('modalPassword').value.trim();
            const alertDiv = document.getElementById('loginModalAlert');

            if(!username || !password) {
                alertDiv.textContent = 'Completa todos los campos';
                alertDiv.classList.remove('hidden');
                return;
            }

            showLoading(true);
            try {
                const response = await fetch(SCRIPT_URL + '?action=login&username=' + username + '&password=' + password + '&type=' + currentLoginType);
                const result = await response.json();
                
                if(result.success) {
                    if(currentLoginType === 'admin' && result.user.role !== 'admin') {
                        alertDiv.textContent = 'No tienes permisos de administrador';
                        alertDiv.classList.remove('hidden');
                        return;
                    }

                    currentUser = result.user;
                    closeLoginModal();
                    
                    if(currentLoginType === 'admin') {
                        openAdminPanel();
                    } else {
                        openUsuarioPanel();
                    }
                } else {
                    alertDiv.textContent = result.message || 'Credenciales incorrectas';
                    alertDiv.classList.remove('hidden');
                }
            } catch(error) {
                alertDiv.textContent = 'Error de conexión: ' + error.message;
                alertDiv.classList.remove('hidden');
            } finally {
                showLoading(false);
            }
        }

        function openUsuarioPanel() {
            document.getElementById('currentUserName').textContent = currentUser.username;
            document.getElementById('usuarioPanel').classList.add('active');
            loadUsuarioOrders();
        }

        function closeUsuarioPanel() {
            document.getElementById('usuarioPanel').classList.remove('active');
            currentUser = null;
        }

        function openAdminPanel() {
            document.getElementById('adminPanel').classList.add('active');
            showAdminTab('orders');
            loadAdminOrders();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
            currentUser = null;
        }

        function showAdminTab(tabName) {
            document.querySelectorAll('.admin-tab-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('#adminPanel .nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById('admin-' + tabName + '-tab').classList.remove('hidden');
            event.target.classList.add('active');

            if(tabName === 'orders') {
                loadAdminOrders();
            } else if(tabName === 'prices') {
                loadPricesTable();
            } else if(tabName === 'branches') {
                loadBranchesTable();
            }
        }

        // CLIENTE - PASO 1: Guardar información
        function saveClientInfo() {
            const name = document.getElementById('clientName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            const email = document.getElementById('clientEmail').value.trim();

            if(!name || !phone) {
                alert('Por favor completa nombre y teléfono');
                return;
            }

            currentClient = { name, phone, email };
            document.getElementById('client-info-step').classList.add('hidden');
            document.getElementById('service-type-step').classList.remove('hidden');
        }

        // CLIENTE - PASO 2: Seleccionar servicio
        function selectService(type) {
            currentService = type;
            document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
            event.target.closest('.service-card').classList.add('selected');

            document.getElementById('service-type-step').classList.add('hidden');
            
            if(type === 'pickup') {
                document.getElementById('branch-selection-step').classList.remove('hidden');
            } else {
                document.getElementById('delivery-address-step').classList.remove('hidden');
            }
        }

        function backToServiceType() {
            document.getElementById('branch-selection-step').classList.add('hidden');
            document.getElementById('delivery-address-step').classList.add('hidden');
            document.getElementById('service-type-step').classList.remove('hidden');
            currentService = '';
        }

        // CLIENTE - PASO 3: Confirmar sucursal
        function confirmBranch() {
            const branch = document.getElementById('branchSelect').value;
            if(!branch) {
                alert('Selecciona una sucursal');
                return;
            }
            currentBranch = branch;
            document.getElementById('branch-selection-step').classList.add('hidden');
            document.getElementById('work-config-step').classList.remove('hidden');
        }

        // CLIENTE - PASO 3b: Confirmar dirección
        function confirmAddress() {
            const street = document.getElementById('deliveryStreet').value.trim();
            const colony = document.getElementById('deliveryColony').value.trim();
            const city = document.getElementById('deliveryCity').value.trim();

            if(!street || !colony || !city) {
                alert('Completa la dirección de entrega');
                return;
            }

            currentClient.address = {
                street,
                colony,
                city,
                zip: document.getElementById('deliveryZip').value,
                references: document.getElementById('deliveryReferences').value
            };

            document.getElementById('delivery-address-step').classList.add('hidden');
            document.getElementById('work-config-step').classList.remove('hidden');
        }

        // CLIENTE - PASO 4: Configurar tipo de impresión
        function updatePrintOptions() {
            const printType = document.getElementById('printType').value;
            
            document.getElementById('vinilOptions').classList.add('hidden');
            document.getElementById('standardOptions').classList.add('hidden');
            document.getElementById('urgencyOptions').classList.add('hidden');
            document.getElementById('finishingOptions').classList.add('hidden');

            if(printType === 'VINIL') {
                document.getElementById('vinilOptions').classList.remove('hidden');
                document.getElementById('urgencyOptions').classList.remove('hidden');
            } else if(printType === 'LONAS') {
                document.getElementById('urgencyOptions').classList.remove('hidden');
            } else if(printType) {
                document.getElementById('standardOptions').classList.remove('hidden');
                document.getElementById('finishingOptions').classList.remove('hidden');
            }

            calculateWorkPrice();
        }

        // Manejo de archivos
        function handleFileSelect() {
            const input = document.getElementById('fileInput');
            if(input.files.length > 0) {
                currentFile = input.files[0];
                
                if(currentFile.size > 50 * 1024 * 1024) {
                    alert('El archivo es muy grande. Máximo 50MB');
                    currentFile = null;
                    input.value = '';
                    return;
                }

                document.getElementById('fileName').textContent = currentFile.name;
                document.getElementById('removeFileBtn').classList.remove('hidden');
                calculateWorkPrice();
            }
        }

        function removeFile() {
            currentFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileName').textContent = 'Haz clic para subir tu archivo';
            document.getElementById('removeFileBtn').classList.add('hidden');
            calculateWorkPrice();
        }

        // Calcular precio del trabajo actual
        function calculateWorkPrice() {
            const printType = document.getElementById('printType').value;
            const copies = parseInt(document.getElementById('copies').value) || 1;

            if(!printType || !currentFile) {
                document.getElementById('workPrice').classList.add('hidden');
                return;
            }

            let basePrice = 0;
            let priceKey = printType;

            if(printType === 'VINIL') {
                const vinilType = document.getElementById('vinilType').value;
                priceKey += '_' + vinilType;
            } else if(printType !== 'LONAS') {
                const color = document.getElementById('colorOption').value;
                const paperType = document.getElementById('paperType').value;
                priceKey += '_' + color + '_' + paperType;
            }

            basePrice = prices[priceKey] || 1.00;
            
            const finishingSelect = document.getElementById('finishing');
            if(finishingSelect && !finishingSelect.classList.contains('hidden')) {
                const selectedFinishing = Array.from(finishingSelect.selectedOptions).map(o => o.value);
                selectedFinishing.forEach(f => {
                    basePrice += (prices['ACABADO_' + f] || 0);
                });
            }

            const totalPrice = basePrice * copies;
            document.getElementById('currentWorkPrice').textContent = '$' + totalPrice.toFixed(2);
            document.getElementById('workPrice').classList.remove('hidden');
        }

        // Agregar al carrito
        function addToCart() {
            const printType = document.getElementById('printType').value;
            const copies = parseInt(document.getElementById('copies').value) || 1;
            const observations = document.getElementById('workObservations').value;

            if(!printType || !currentFile) {
                alert('Completa todos los campos obligatorios');
                return;
            }

            const work = {
                fileName: currentFile.name,
                fileData: currentFile,
                printType: printType,
                copies: copies,
                observations: observations,
                price: parseFloat(document.getElementById('currentWorkPrice').textContent.replace('$', ''))
            };

            if(printType === 'VINIL') {
                work.vinilType = document.getElementById('vinilType').value;
                work.urgency = document.getElementById('urgencyMode').value;
            } else if(printType === 'LONAS') {
                work.urgency = document.getElementById('urgencyMode').value;
            } else {
                work.color = document.getElementById('colorOption').value;
                work.paperType = document.getElementById('paperType').value;
                const finishingSelect = document.getElementById('finishing');
                work.finishing = Array.from(finishingSelect.selectedOptions).map(o => o.value);
            }

            cart.push(work);
            alert('Trabajo agregado al carrito');
            resetWorkForm();
            showCart();
        }

        function addAnotherWork() {
            const printType = document.getElementById('printType').value;
            if(!printType || !currentFile) {
                alert('Completa el trabajo actual antes de agregar otro');
                return;
            }
            addToCart();
        }

        function resetWorkForm() {
            document.getElementById('printType').value = '';
            document.getElementById('copies').value = '1';
            document.getElementById('workObservations').value = '';
            removeFile();
            document.getElementById('workPrice').classList.add('hidden');
            updatePrintOptions();
        }

        function backToWork() {
            document.getElementById('cart-step').classList.add('hidden');
            document.getElementById('work-config-step').classList.remove('hidden');
        }

        // Mostrar carrito
        function showCart() {
            document.getElementById('work-config-step').classList.add('hidden');
            document.getElementById('cart-step').classList.remove('hidden');
            
            const cartItems = document.getElementById('cartItems');
            cartItems.innerHTML = '';

            let subtotal = 0;
            cart.forEach((work, index) => {
                subtotal += work.price;
                const item = document.createElement('div');
                item.className = 'cart-item';
                item.innerHTML = `
                    <div class="cart-item-header">
                        <strong>${work.fileName}</strong>
                        <button class="btn btn-danger" onclick="removeFromCart(${index})" style="padding: 5px 10px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="cart-item-details">Cantidad: ${work.copies} copias</div>
                    <div class="cart-item-details">Tipo: ${work.printType}</div>
                    ${work.color ? `<div class="cart-item-details">Color: ${work.color} | Papel: ${work.paperType}</div>` : ''}
                    ${work.vinilType ? `<div class="cart-item-details">Vinil: ${work.vinilType}</div>` : ''}
                    ${work.finishing && work.finishing.length > 0 ? `<div class="cart-item-details">Acabado: ${work.finishing.join(', ')}</div>` : ''}
                    <div class="cart-item-details"><strong>Precio: $${work.price.toFixed(2)}</strong></div>
                `;
                cartItems.appendChild(item);
            });

            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            
            let deliveryCost = 0;
            if(currentService === 'delivery') {
                deliveryCost = parseFloat(prices.DELIVERY_FEE || 50);
                document.getElementById('deliveryCostLine').classList.remove('hidden');
                document.getElementById('deliveryCost').textContent = deliveryCost.toFixed(2);
            } else {
                document.getElementById('deliveryCostLine').classList.add('hidden');
            }

            const total = subtotal + deliveryCost;
            document.getElementById('total').textContent = total.toFixed(2);

            updatePaymentInfo();
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            if(cart.length === 0) {
                backToWork();
            } else {
                showCart();
            }
        }
        // Actualizar información de pago
        function updatePaymentInfo() {
            const method = document.getElementById('paymentMethod').value;
            const total = parseFloat(document.getElementById('total').textContent);

            if(method === 'EFECTIVO' && currentService === 'delivery') {
                alert('Para entrega a domicilio el pago debe ser por transferencia');
                document.getElementById('paymentMethod').value = 'TRANSFERENCIA';
                return;
            }

            if(method === 'EFECTIVO' && total > 50) {
                alert('Para pedidos mayores a $50 el pago debe ser por transferencia');
                document.getElementById('paymentMethod').value = 'TRANSFERENCIA';
                return;
            }

            if(method === 'TRANSFERENCIA') {
                document.getElementById('transferInfo').classList.remove('hidden');
                document.getElementById('uploadProof').classList.remove('hidden');
                
                const branch = branches.find(b => b.name === currentBranch) || branches[0];
                document.getElementById('bankDetails').innerHTML = branch ? branch.bankData.replace(/\n/g, '<br>') : 'Cargando...';
            } else {
                document.getElementById('transferInfo').classList.add('hidden');
                document.getElementById('uploadProof').classList.add('hidden');
                document.getElementById('submitOrderBtn').disabled = false;
            }
        }

        function handleProofUpload() {
            const input = document.getElementById('proofInput');
            if(input.files.length > 0) {
                currentProof = input.files[0];
                document.getElementById('submitOrderBtn').disabled = false;
            }
        }

        // Enviar pedido
        async function submitOrder() {
            if(cart.length === 0) {
                alert('El carrito está vacío');
                return;
            }

            const method = document.getElementById('paymentMethod').value;
            if(method === 'TRANSFERENCIA' && !currentProof) {
                alert('Debes subir el comprobante de pago');
                return;
            }

            showLoading(true);

            try {
                const folio = 'ORD-' + new Date().toISOString().split('T')[0].replace(/-/g, '') + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                
                const orderData = {
                    action: 'createOrder',
                    folio: folio,
                    client: currentClient,
                    serviceType: currentService,
                    branch: currentBranch,
                    works: cart.map(w => ({
                        fileName: w.fileName,
                        printType: w.printType,
                        copies: w.copies,
                        color: w.color,
                        paperType: w.paperType,
                        vinilType: w.vinilType,
                        finishing: w.finishing,
                        urgency: w.urgency,
                        observations: w.observations,
                        price: w.price
                    })),
                    paymentMethod: method,
                    subtotal: parseFloat(document.getElementById('subtotal').textContent),
                    deliveryCost: currentService === 'delivery' ? parseFloat(document.getElementById('deliveryCost').textContent) : 0,
                    total: parseFloat(document.getElementById('total').textContent),
                    status: 'new',
                    date: new Date().toISOString()
                };

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(orderData)
                });

                const result = await response.json();
                
                if(result.success) {
                    showTicket(orderData);
                } else {
                    alert('Error al crear pedido: ' + result.message);
                }
            } catch(error) {
                alert('Error: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Mostrar ticket
        function showTicket(order) {
            const content = document.getElementById('ticketContent');
            content.innerHTML = `
                <div class="ticket">
                    <div class="ticket-header">
                        <h2>CENTRO DE COPIADO</h2>
                        <p>Ticket de Pedido</p>
                    </div>
                    <p><strong>Folio:</strong> ${order.folio}</p>
                    <p><strong>Fecha:</strong> ${new Date(order.date).toLocaleString('es-MX')}</p>
                    <p><strong>Cliente:</strong> ${order.client.name}</p>
                    <p><strong>Teléfono:</strong> ${order.client.phone}</p>
                    <p><strong>Servicio:</strong> ${order.serviceType === 'pickup' ? 'Pick-up en ' + order.branch : 'Entrega a Domicilio'}</p>
                    <hr>
                    <h4>Trabajos:</h4>
                    ${order.works.map((w, idx) => `
                        <div class="ticket-item">
                            <p><strong>${idx + 1}. ${w.fileName}</strong></p>
                            <p>Cantidad: ${w.copies} copias</p>
                            <p>Tipo: ${w.printType}</p>
                            ${w.color ? `<p>Color: ${w.color} | Papel: ${w.paperType}</p>` : ''}
                            ${w.vinilType ? `<p>Vinil: ${w.vinilType}</p>` : ''}
                            ${w.finishing && w.finishing.length > 0 ? `<p>Acabado: ${w.finishing.join(', ')}</p>` : ''}
                            ${w.observations ? `<p>Obs: ${w.observations}</p>` : ''}
                            <p style="text-align: right;"><strong>$${w.price.toFixed(2)}</strong></p>
                        </div>
                    `).join('')}
                    <hr>
                    <p><strong>Subtotal:</strong> $${order.subtotal.toFixed(2)}</p>
                    ${order.deliveryCost > 0 ? `<p><strong>Entrega:</strong> $${order.deliveryCost.toFixed(2)}</p>` : ''}
                    <h3><strong>TOTAL:</strong> $${order.total.toFixed(2)}</h3>
                    <p><strong>Método de Pago:</strong> ${order.paymentMethod}</p>
                    <hr>
                    <p style="text-align: center; margin-top: 15px;">¡Gracias por su preferencia!</p>
                    <p style="text-align: center; font-size: 0.9em;">Guarda tu folio para rastrear tu pedido</p>
                </div>
            `;
            
            currentOrder = order;
            document.getElementById('ticketModal').classList.add('active');
        }

        function closeTicketModal() {
            document.getElementById('ticketModal').classList.remove('active');
            resetAll();
        }

        function printTicket() {
            window.print();
        }

        function downloadTicket() {
            const content = document.getElementById('ticketContent').innerHTML;
            const blob = new Blob([content], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ticket-' + currentOrder.folio + '.html';
            a.click();
        }

        function sendToWhatsApp() {
            if(!currentClient.phone) {
                alert('No hay número de teléfono registrado');
                return;
            }
            
            const message = `*TICKET DE PEDIDO*%0A` +
                `Folio: ${currentOrder.folio}%0A` +
                `Total: $${currentOrder.total.toFixed(2)}%0A` +
                `Servicio: ${currentOrder.serviceType === 'pickup' ? 'Pick-up' : 'Entrega a Domicilio'}`;
            
            window.open(`https://wa.me/52${currentClient.phone}?text=${message}`, '_blank');
        }

        function resetAll() {
            currentClient = {};
            currentService = '';
            currentBranch = '';
            cart = [];
            currentFile = null;
            currentProof = null;
            currentOrder = null;
            
            document.getElementById('client-info-step').classList.remove('hidden');
            document.getElementById('service-type-step').classList.add('hidden');
            document.getElementById('branch-selection-step').classList.add('hidden');
            document.getElementById('delivery-address-step').classList.add('hidden');
            document.getElementById('work-config-step').classList.add('hidden');
            document.getElementById('cart-step').classList.add('hidden');
            
            document.querySelectorAll('input').forEach(i => i.value = '');
            document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
        }

        // CARGAR PEDIDOS
        async function loadUsuarioOrders() {
            showLoading(true);
            try {
                const response = await fetch(SCRIPT_URL + '?action=getOrders&employee=' + currentUser.username);
                const result = await response.json();
                
                if(result.success) {
                    allOrders = result.orders;
                    displayUsuarioOrders(result.orders);
                }
            } catch(error) {
                console.error(error);
            } finally {
                showLoading(false);
            }
        }

        function displayUsuarioOrders(orders) {
            const container = document.getElementById('usuarioOrdersList');
            container.innerHTML = '';
            
            if(orders.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No hay pedidos asignados</p>';
                return;
            }
            
            orders.forEach(order => {
                const div = document.createElement('div');
                div.className = 'work-item';
                
                const statusText = getStatusText(order.status);
                const statusClass = 'status-' + order.status;
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 20px;">
                        <div style="flex: 1;">
                            <h4><i class="fas fa-file-alt"></i> ${order.folio}</h4>
                            <p style="margin: 5px 0;"><strong>${order.client.name}</strong> - ${order.client.phone}</p>
                            <p style="margin: 5px 0;">Total: <strong>$${order.total}</strong> | ${order.serviceType === 'pickup' ? 'Pick-up en ' + order.branch : 'Entrega a Domicilio'}</p>
                            <p style="margin: 5px 0; font-size: 0.9em; color: #666;">
                                <i class="far fa-clock"></i> ${new Date(order.date).toLocaleString('es-MX')}
                            </p>
                            <span class="order-status ${statusClass}">${statusText}</span>
                        </div>
                        <button class="btn btn-primary" onclick='viewOrderDetail(${JSON.stringify(order).replace(/'/g, "&apos;")})'>
                            <i class="fas fa-eye"></i> Ver Detalle
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function filterOrders(status) {
            if(status === 'all') {
                displayUsuarioOrders(allOrders);
            } else {
                const filtered = allOrders.filter(o => o.status === status);
                displayUsuarioOrders(filtered);
            }
        }

        async function loadAdminOrders() {
            showLoading(true);
            try {
                const response = await fetch(SCRIPT_URL + '?action=getAllOrders');
                const result = await response.json();
                
                if(result.success) {
                    allOrders = result.orders;
                    displayAdminOrders(result.orders);
                }
            } catch(error) {
                console.error(error);
            } finally {
                showLoading(false);
            }
        }

        function displayAdminOrders(orders) {
            const container = document.getElementById('adminOrdersList');
            container.innerHTML = '';
            
            if(orders.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No hay pedidos</p>';
                return;
            }
            
            orders.forEach(order => {
                const div = document.createElement('div');
                div.className = 'work-item';
                
                const statusText = getStatusText(order.status);
                const statusClass = 'status-' + order.status;
                const employeeName = order.employee || 'Sin asignar';
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 20px;">
                        <div style="flex: 1;">
                            <h4><i class="fas fa-file-alt"></i> ${order.folio}</h4>
                            <p style="margin: 5px 0;"><strong>${order.client.name}</strong> - ${order.client.phone}</p>
                            <p style="margin: 5px 0;">Total: <strong>$${order.total}</strong> | ${order.serviceType === 'pickup' ? 'Pick-up en ' + order.branch : 'Entrega a Domicilio'}</p>
                            <p style="margin: 5px 0; font-size: 0.9em; color: #666;">
                                <i class="far fa-clock"></i> ${new Date(order.date).toLocaleString('es-MX')}
                            </p>
                            <p style="margin: 5px 0;">
                                <i class="fas fa-user"></i> Empleado: <strong>${employeeName}</strong>
                            </p>
                            <span class="order-status ${statusClass}">${statusText}</span>
                        </div>
                        <button class="btn btn-primary" onclick='viewOrderDetail(${JSON.stringify(order).replace(/'/g, "&apos;")})'>
                            <i class="fas fa-eye"></i> Ver Detalle
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function filterAdminOrders(status) {
            if(status === 'all') {
                displayAdminOrders(allOrders);
            } else {
                const filtered = allOrders.filter(o => o.status === status);
                displayAdminOrders(filtered);
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'new': 'Nuevo (Recibido)',
                'assigned': 'Asignado',
                'processing': 'En Elaboración',
                'ready': 'Listo para Entrega',
                'delivering': 'En Camino',
                'delivered': 'Entregado'
            };
            return statusMap[status] || status;
        }

        function viewOrderDetail(order) {
            currentOrder = order;
            
            const detailContent = document.getElementById('orderDetailContent');
            detailContent.innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3><i class="fas fa-receipt"></i> ${order.folio}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div>
                            <p><strong>Cliente:</strong> ${order.client.name}</p>
                            <p><strong>Teléfono:</strong> ${order.client.phone}</p>
                            <p><strong>Email:</strong> ${order.client.email || 'N/A'}</p>
                        </div>
                        <div>
                            <p><strong>Fecha:</strong> ${new Date(order.date).toLocaleString('es-MX')}</p>
                            <p><strong>Servicio:</strong> ${order.serviceType === 'pickup' ? 'Pick-up en ' + order.branch : 'Entrega a Domicilio'}</p>
                            <p><strong>Método de Pago:</strong> ${order.paymentMethod}</p>
                        </div>
                        <div>
                            <p><strong>Subtotal:</strong> $${order.subtotal}</p>
                            <p><strong>Entrega:</strong> $${order.deliveryCost || 0}</p>
                            <p><strong>Total:</strong> <span style="color: #667eea; font-size: 1.2em;">$${order.total}</span></p>
                        </div>
                    </div>
                </div>

                <h4><i class="fas fa-list"></i> Trabajos Solicitados</h4>
                <div style="margin-bottom: 20px;">
                    ${order.works.map((work, idx) => `
                        <div class="cart-item" style="margin-bottom: 10px;">
                            <p><strong>${idx + 1}. ${work.fileName}</strong></p>
                            <p>Cantidad: ${work.copies} | Tipo: ${work.printType}</p>
                            ${work.color ? `<p>Color: ${work.color} | Papel: ${work.paperType}</p>` : ''}
                            ${work.vinilType ? `<p>Vinil: ${work.vinilType}</p>` : ''}
                            ${work.finishing && work.finishing.length > 0 ? `<p>Acabado: ${work.finishing.join(', ')}</p>` : ''}
                            ${work.observations ? `<p><em>Obs: ${work.observations}</em></p>` : ''}
                            <p style="text-align: right;"><strong>$${work.price.toFixed(2)}</strong></p>
                        </div>
                    `).join('')}
                </div>
            `;

            buildTimeline(order);
            document.getElementById('orderStatus').value = order.status;
            document.getElementById('statusNotes').value = '';
            document.getElementById('orderDetailModal').classList.add('active');
        }

        function buildTimeline(order) {
            const timeline = document.getElementById('orderTimeline');
            const history = order.history || [];
            
            const states = [
                { key: 'new', label: 'Pedido Recibido', icon: 'fa-inbox' },
                { key: 'assigned', label: 'Asignado a Empleado', icon: 'fa-user-check' },
                { key: 'processing', label: 'En Elaboración', icon: 'fa-cogs' },
                { key: 'ready', label: 'Listo para Entrega', icon: 'fa-check-circle' },
                { key: 'delivering', label: 'En Camino', icon: 'fa-shipping-fast' },
                { key: 'delivered', label: 'Entregado al Cliente', icon: 'fa-handshake' }
            ];

            const currentStateIndex = states.findIndex(s => s.key === order.status);
            
            timeline.innerHTML = states.map((state, index) => {
                const historyItem = history.find(h => h.status === state.key);
                const isCompleted = index <= currentStateIndex;
                const isActive = index === currentStateIndex;
                
                let itemClass = 'timeline-item';
                if(isCompleted && !isActive) itemClass += ' completed';
                if(isActive) itemClass += ' active';
                
                return `
                    <div class="${itemClass}">
                        <div class="timeline-content">
                            <div class="timeline-title">
                                <i class="fas ${state.icon}"></i> ${state.label}
                            </div>
                            ${historyItem ? `
                                <div class="timeline-meta">
                                    <i class="far fa-clock"></i> ${new Date(historyItem.timestamp).toLocaleString('es-MX')}
                                </div>
                                ${historyItem.employee ? `
                                    <span class="timeline-employee">
                                        <i class="fas fa-user"></i> ${historyItem.employee}
                                    </span>
                                ` : ''}
                                ${historyItem.notes ? `
                                    <div style="margin-top: 5px; font-size: 0.9em; font-style: italic; color: #555;">
                                        "${historyItem.notes}"
                                    </div>
                                ` : ''}
                            ` : (isActive ? `
                                <div class="timeline-meta" style="color: #ffc107;">
                                    <i class="fas fa-hourglass-half"></i> En proceso...
                                </div>
                            ` : '')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function closeOrderDetail() {
            document.getElementById('orderDetailModal').classList.remove('active');
            currentOrder = null;
        }

        async function updateOrderStatus() {
            const newStatus = document.getElementById('orderStatus').value;
            const notes = document.getElementById('statusNotes').value.trim();

            if(!currentOrder) {
                alert('No hay pedido seleccionado');
                return;
            }

            if(newStatus === currentOrder.status && !notes) {
                alert('No hay cambios para guardar');
                return;
            }

            showLoading(true);
            try {
                const updateData = {
                    action: 'updateOrderStatus',
                    folio: currentOrder.folio,
                    status: newStatus,
                    employee: currentUser.username,
                    notes: notes,
                    timestamp: new Date().toISOString()
                };

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();
                
                if(result.success) {
                    alert('Estado actualizado correctamente');
                    closeOrderDetail();
                    
                    if(document.getElementById('usuarioPanel').classList.contains('active')) {
                        loadUsuarioOrders();
                    } else if(document.getElementById('adminPanel').classList.contains('active')) {
                        loadAdminOrders();
                    }
                } else {
                    alert('Error al actualizar: ' + result.message);
                }
            } catch(error) {
                alert('Error: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function notifyClient() {
            if(currentOrder && currentOrder.client.phone) {
                const statusText = getStatusText(currentOrder.status);
                const message = `Hola ${currentOrder.client.name}, tu pedido ${currentOrder.folio} está: ${statusText}`;
                window.open(`https://wa.me/52${currentOrder.client.phone}?text=${encodeURIComponent(message)}`, '_blank');
            }
        }

        // ADMIN - Gestión de Precios
        async function loadPricesTable() {
            showLoading(true);
            try {
                const response = await fetch(SCRIPT_URL + '?action=getPrices');
                const result = await response.json();
                
                if(result.success) {
                    const table = document.getElementById('pricesTable');
                    let html = `
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #667eea; color: white;">
                                    <th style="padding: 12px; text-align: left;">Categoría</th>
                                    <th style="padding: 12px; text-align: left;">Subcategoría</th>
                                    <th style="padding: 12px; text-align: right;">Precio</th>
                                    <th style="padding: 12px; text-align: center;">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    for(let key in result.prices) {
                        const parts = key.split('_');
                        const category = parts[0];
                        const subcategory = parts.slice(1).join('_') || '-';
                        const price = result.prices[key];

                        html += `
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 10px;">${category}</td>
                                <td style="padding: 10px;">${subcategory}</td>
                                <td style="padding: 10px; text-align: right;">$${price}</td>
                                <td style="padding: 10px; text-align: center;">
                                    <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.9em;" 
                                        onclick='editPrice("${category}", "${subcategory}", ${price})'>
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }

                    html += '</tbody></table>';
                    table.innerHTML = html;
                }
            } catch(error) {
                console.error(error);
            } finally {
                showLoading(false);
            }
        }

        function editPrice(category, subcategory, price) {
            document.getElementById('priceCategory').value = category;
            document.getElementById('priceSubcategory').value = subcategory === '-' ? '' : subcategory;
            document.getElementById('priceValue').value = price;
            window.scrollTo({ top: document.getElementById('priceCategory').offsetTop - 100, behavior: 'smooth' });
        }

        async function savePrice() {
            const category = document.getElementById('priceCategory').value.trim();
            const subcategory = document.getElementById('priceSubcategory').value.trim();
            const price = parseFloat(document.getElementById('priceValue').value);

            if(!category || isNaN(price)) {
                alert('Completa categoría y precio');
                return;
            }

            showLoading(true);
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'updatePrice',
                        category: category,
                        subcategory: subcategory,
                        price: price
                    })
                });

                const result = await response.json();
                
                if(result.success) {
                    alert('Precio guardado correctamente');
                    document.getElementById('priceCategory').value = '';
                    document.getElementById('priceSubcategory').value = '';
                    document.getElementById('priceValue').value = '';
                    loadPricesTable();
                    loadPrices();
                } else {
                    alert('Error: ' + result.message);
                }
            } catch(error) {
                alert('Error: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function loadBranchesTable() {
            showLoading(true);
            try {
                const response = await fetch(SCRIPT_URL + '?action=getBranches');
                const result = await response.json();
                
                if(result.success) {
                    const table = document.getElementById('branchesTable');
                    let html = `
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #667eea; color: white;">
                                    <th style="padding: 12px; text-align: left;">Nombre</th>
                                    <th style="padding: 12px; text-align: left;">Dirección</th>
                                    <th style="padding: 12px; text-align: left;">Teléfono</th>
                                    <th style="padding: 12px; text-align: left;">Datos Bancarios</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    result.branches.forEach(branch => {
                        html += `
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 10px;"><strong>${branch.name}</strong></td>
                                <td style="padding: 10px;">${branch.address}</td>
                                <td style="padding: 10px;">${branch.phone}</td>
                                <td style="padding: 10px; white-space: pre-line; font-size: 0.85em;">${branch.bankData}</td>
                            </tr>
                        `;
                    });

                    html += '</tbody></table>';
                    table.innerHTML = html;
                }
            } catch(error) {
                console.error(error);
            } finally {
                showLoading(false);
            }
        }

        async function saveBranch() {
            const name = document.getElementById('branchName').value.trim();
            const address = document.getElementById('branchAddress').value.trim();
            const phone = document.getElementById('branchPhone').value.trim();
            const bankData = document.getElementById('branchBankData').value.trim();

            if(!name || !address || !phone) {
                alert('Completa todos los campos obligatorios');
                return;
            }

            showLoading(true);
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'saveBranch',
                        name: name,
                        address: address,
                        phone: phone,
                        bankData: bankData
                    })
                });

                const result = await response.json();
                
                if(result.success) {
                    alert('Sucursal guardada correctamente');
                    document.getElementById('branchName').value = '';
                    document.getElementById('branchAddress').value = '';
                    document.getElementById('branchPhone').value = '';
                    document.getElementById('branchBankData').value = '';
                    loadBranchesTable();
                    loadBranches();
                } else {
                    alert('Error: ' + result.message);
                }
            } catch(error) {
                alert('Error: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function loadPrices() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getPrices');
                const result = await response.json();
                if(result.success) {
                    prices = result.prices;
                }
            } catch(error) {
                console.error(error);
            }
        }

        async function loadBranches() {
            try {
                const response = await fetch(SCRIPT_URL + '?action=getBranches');
                const result = await response.json();
                if(result.success) {
                    branches = result.branches;
                    const select = document.getElementById('branchSelect');
                    select.innerHTML = '<option value="">Selecciona una sucursal</option>';
                    branches.forEach(b => {
                        const option = document.createElement('option');
                        option.value = b.name;
                        option.textContent = b.name + ' - ' + b.address;
                        select.appendChild(option);
                    });
                }
            } catch(error) {
                console.error(error);
            }
        }

        async function trackOrder() {
            const folio = document.getElementById('trackingFolio').value.trim();
            if(!folio) {
                alert('Ingresa el número de folio');
                return;
            }

            showLoading(true);
            try {
                const response = await fetch(SCRIPT_URL + '?action=trackOrder&folio=' + folio);
                const result = await response.json();
                
                if(result.success) {
                    displayTracking(result.order);
                } else {
                    alert('Pedido no encontrado');
                }
            } catch(error) {
                alert('Error: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayTracking(order) {
            const results = document.getElementById('trackingResults');
            const statusText = getStatusText(order.status);
            const statusClass = 'status-' + order.status;
            
            results.innerHTML = `
                <div class="cart-item">
                    <h3>Pedido ${order.folio}</h3>
                    <p><strong>Estado:</strong> <span class="order-status ${statusClass}">${statusText}</span></p>
                    <p><strong>Cliente:</strong> ${order.client.name}</p>
                    <p><strong>Total:</strong> ${order.total}</p>
                    <p><strong>Fecha:</strong> ${new Date(order.date).toLocaleString('es-MX')}</p>
                    ${order.employee ? `<p><strong>Atendido por:</strong> ${order.employee}</p>` : ''}
                </div>
            `;
            
            if(order.history && order.history.length > 0) {
                results.innerHTML += '<h4 style="margin-top: 20px;"><i class="fas fa-history"></i> Historial</h4>';
                const timelineDiv = document.createElement('div');
                timelineDiv.className = 'timeline';
                
                order.history.forEach(h => {
                    const item = document.createElement('div');
                    item.className = 'timeline-item completed';
                    item.innerHTML = `
                        <div class="timeline-content">
                            <div class="timeline-title">${getStatusText(h.status)}</div>
                            <div class="timeline-meta">
                                <i class="far fa-clock"></i> ${new Date(h.timestamp).toLocaleString('es-MX')}
                            </div>
                            ${h.employee ? `<span class="timeline-employee"><i class="fas fa-user"></i> ${h.employee}</span>` : ''}
                            ${h.notes ? `<div style="margin-top: 5px; font-style: italic;">${h.notes}</div>` : ''}
                        </div>
                    `;
                    timelineDiv.appendChild(item);
                });
                
                results.appendChild(timelineDiv);
            }
            
            if(order.serviceType === 'delivery' && order.status === 'delivering') {
                document.getElementById('trackingMap').classList.remove('hidden');
                initMap();
            }
        }

        function initMap() {
            const map = L.map('map').setView([17.989, -92.948], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            L.marker([17.989, -92.948]).addTo(map).bindPopup('Tu pedido está en camino');
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function generateReport() {
            alert('Funcionalidad de reportes en desarrollo');
        }
    </script>
</body>
</html>
